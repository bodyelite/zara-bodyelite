import { registrarConversacion } from "./memoria.js";
import baseConocimiento from "./base_conocimiento.js";
import logs from "./logs_wsp.json" assert { type: "json" };

/* === FUNCI√ìN PRINCIPAL DE RESPUESTA === */
export async function responder(mensaje) {
  const t = mensaje.toLowerCase().trim();
  let respuesta = "";

  /* --- RESPUESTAS EMP√ÅTICAS / CL√çNICAS --- */
  if (t.includes("poto") || t.includes("gluteo") || t.includes("gl√∫teo") || t.includes("trasero") || (t.includes("levantar") && (t.includes("gluteo") || t.includes("poto")))) {
    return "Hola üòä Esa zona se puede levantar y tonificar sin cirug√≠a ‚ú®\nCon nuestros planes **Push Up** desde $376.000 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  if (t.includes("panza") || t.includes("abdomen") || t.includes("vientre") || t.includes("rollito") || t.includes("grasa localizada") || t.includes("reductor")) {
    return "Hola üòä Esa grasita abdominal se puede tratar sin cirug√≠a ‚ú®\nCon nuestros planes **Lipo Reductiva** desde $348.800 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  if (t.includes("brazo") || t.includes("brazos") || (t.includes("flacidez") && t.includes("brazo"))) {
    return "Hola üòä Esa flacidez en brazos se puede mejorar sin cirug√≠a ‚ú®\nCon nuestros planes **Body Tensor** desde $232.000 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  if (t.includes("flacidez corporal") || t.includes("tonificar") || t.includes("endurecer")) {
    return "Hola üòä Podemos ayudarte a tonificar y reafirmar la piel ‚ú®\nCon nuestros planes **Body Fitness** desde $360.000 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  if (t.includes("cara") || t.includes("rostro") || t.includes("papada") || t.includes("arrugas") || t.includes("frente") || t.includes("ojeras") || t.includes("piel apagada") || t.includes("cara cansada")) {
    return "Hola üòä Podemos mejorar la firmeza y luminosidad de tu rostro ‚ú®\nCon nuestros planes **Face Smart** desde $198.400 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  if (t.includes("acne") || t.includes("espinilla") || t.includes("grano") || t.includes("piel grasa") || t.includes("imperfeccion")) {
    return "Hola üòä Ese tipo de piel se puede equilibrar con limpieza profunda y luz LED ‚ú®\nCon nuestros planes **Limpieza Facial Full** desde $120.000 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  if (t.includes("hifu") || t.includes("radiofrecuencia") || t.includes("ems") || t.includes("sculptor") || t.includes("cavitacion")) {
    return "Hola üòä Trabajamos con tecnolog√≠a avanzada como HIFU 12D, Cavitaci√≥n y EMS Sculptor ‚ú®\nPodemos recomendarte un plan desde $348.800 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  if (t.includes("toxina") || t.includes("botox") || t.includes("arrugas") || t.includes("expresion")) {
    return "Hola üòä Podemos suavizar las l√≠neas de expresi√≥n y mejorar la firmeza facial ‚ú®\nCon nuestros planes **Face Elite** desde $358.400 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  if (t.includes("manchas") || t.includes("luminosidad") || t.includes("rejuvenecer") || t.includes("antiedad") || t.includes("antiage") || t.includes("renovar")) {
    return "Hola üòä Podemos rejuvenecer y devolver luminosidad a tu piel ‚ú®\nCon nuestros planes **Face Antiage** desde $281.600 (valor referencial, sujeto a evaluaci√≥n cl√≠nica).\nüîó Agenda tu evaluaci√≥n gratuita üëâ https://agendamiento.reservo.cl/makereserva/agenda/f0Hq15w0M0nrxU8d7W64x5t2S6L4h9\n\nüìç Av. Las Perdices 2990, Pe√±alol√©n\nüïê Lun‚ÄìVie 9:30‚Äì20:00 ¬∑ S√°b 9:30‚Äì13:00";
  }

  /* --- SI NO HAY COINCIDENCIAS --- */
  respuesta = baseConocimiento.find((e) => t.includes(e.pregunta));
  if (respuesta) return respuesta.respuesta;

  return "‚ú® Soy Zara IA de Body Elite. Cu√©ntame qu√© zona deseas mejorar (rostro, abdomen, gl√∫teos, muslos, brazos, etc.) y te indicar√© el tratamiento ideal con descripci√≥n y valor.";
}
