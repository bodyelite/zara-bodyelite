<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat Zara - Body Elite</title>
    <style>
        /* Estilos base para integraci√≥n limpia */
        body { margin: 0; padding: 0; background-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* Animaciones */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div id="z-c" style="position:fixed;bottom:20px;right:20px;width:340px;max-width:90%;z-index:99999;font-family:sans-serif;display:none;box-shadow:0 8px 30px rgba(0,0,0,0.15);border-radius:16px;overflow:hidden;background:#fff;border:1px solid #f0f0f0;animation: slideIn 0.3s ease-out;">
    
    <div style="background:linear-gradient(135deg, #0d9488 0%, #115e59 100%);padding:16px;color:#fff;font-weight:600;display:flex;align-items:center;gap:12px;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
        <div style="width:38px;height:38px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#0d9488;font-weight:bold;font-size:18px;box-shadow:0 2px 4px rgba(0,0,0,0.1)">Z</div>
        <div style="flex:1">
            <div style="font-size:15px;letter-spacing:0.3px">Zara (Body Elite)</div>
            <div style="font-size:12px;opacity:0.9;display:flex;align-items:center;gap:5px;margin-top:2px">
                <span style="width:8px;height:8px;background:#4ade80;border-radius:50%;display:inline-block;box-shadow:0 0 4px #4ade80"></span> En l√≠nea ahora
            </div>
        </div>
        <div style="cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center;opacity:0.8;font-size:18px;transition:opacity 0.2s" onclick="toggleChat()" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.8'">‚úï</div>
    </div>
    
    <div id="z-b" style="height:360px;overflow-y:auto;padding:16px;font-size:14px;display:flex;flex-direction:column;gap:12px;background:#f8fafc">
        <div style="align-self:flex-start;background:#fff;padding:12px 16px;border-radius:12px 12px 12px 2px;max-width:85%;color:#334155;border:1px solid #e2e8f0;box-shadow:0 1px 2px rgba(0,0,0,0.05)">
            ¬°Hola! üëã Soy Zara, tu asistente experta de Body Elite. <br><br><b>¬øTe gustar√≠a evaluar un tratamiento Corporal o Facial hoy?</b> ‚ú®
        </div>
    </div>
    
    <div style="padding:12px;display:flex;gap:8px;border-top:1px solid #f1f5f9;background:#fff">
        <input id="z-i" type="text" placeholder="Escribe aqu√≠..." style="flex:1;padding:12px;background:#f8fafc;border:1px solid #cbd5e1;border-radius:24px;outline:none;font-size:14px;transition:border-color 0.2s" onfocus="this.style.borderColor='#0d9488'" onblur="this.style.borderColor='#cbd5e1'">
        <button onclick="sMsg()" style="background:#f97316;color:#fff;border:none;width:42px;height:42px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;transition:transform 0.1s;box-shadow:0 2px 5px rgba(249, 115, 22, 0.3)" onmousedown="this.style.transform='scale(0.95)'" onmouseup="this.style.transform='scale(1)'">‚ûú</button>
    </div>
    
    <div style="text-align:center;font-size:10px;color:#94a3b8;padding-bottom:8px;background:#fff">Powered by Zara AI</div>
</div>

<button id="z-t" onclick="toggleChat()" style="position:fixed;bottom:20px;right:20px;background:#0d9488;color:#fff;width:64px;height:64px;border-radius:50%;border:none;cursor:pointer;font-size:32px;box-shadow:0 4px 15px rgba(13, 148, 136, 0.4);z-index:9998;display:flex;align-items:center;justify-content:center;transition:all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);">üí¨</button>

<script>
    const chatContainer = document.getElementById('z-c');
    const toggleBtn = document.getElementById('z-t');
    
    // URL DEL BACKEND (Render)
    const RENDER_URL = 'https://zara-bodyelite-1.onrender.com/webchat';

    // ID de sesi√≥n √∫nico
    const sessionUserId = 'web-' + Math.random().toString(36).substr(2, 9);

    function toggleChat() {
        if (chatContainer.style.display === 'none' || chatContainer.style.display === '') {
            chatContainer.style.display = 'block';
            toggleBtn.style.transform = 'scale(0) rotate(180deg)';
            setTimeout(() => toggleBtn.style.display = 'none', 200);
            
            // Foco autom√°tico al abrir
            setTimeout(() => document.getElementById('z-i').focus(), 300);
        } else {
            chatContainer.style.display = 'none';
            toggleBtn.style.display = 'flex';
            setTimeout(() => toggleBtn.style.transform = 'scale(1) rotate(0deg)', 50);
        }
    }

    // Auto-apertura a los 2.5 segundos
    setTimeout(() => {
        if (chatContainer.style.display === 'none' || chatContainer.style.display === '') {
            toggleChat();
        }
    }, 2500);

    async function sMsg() {
        const input = document.getElementById('z-i');
        const box = document.getElementById('z-b');
        
        const userMsg = input.value.trim();
        if(!userMsg) return;
        
        input.value = '';
        
        // Render Usuario
        box.innerHTML += `<div style="align-self:flex-end;background:#e2e8f0;padding:10px 14px;border-radius:12px 12px 2px 12px;max-width:85%;color:#334155;font-size:14px;margin-bottom:5px">${userMsg}</div>`;
        box.scrollTop = box.scrollHeight;

        try {
            // Loading Indicator
            const loadingId = 'loading-' + Date.now();
            box.innerHTML += `<div id="${loadingId}" style="align-self:flex-start;color:#94a3b8;font-size:12px;margin-left:10px;margin-bottom:5px">Escribiendo...</div>`;
            box.scrollTop = box.scrollHeight;

            const response = await fetch(RENDER_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: userMsg, userId: sessionUserId })
            });
            
            const data = await response.json();
            
            // Remover loading
            document.getElementById(loadingId).remove();
            
            // Render Zara
            // Nota: usamos .replace para convertir saltos de l√≠nea (\n) en <br> si vienen del backend
            const cleanResponse = data.response.replace(/\n/g, '<br>');
            
            box.innerHTML += `<div style="align-self:flex-start;background:#f0fdfa;padding:12px 16px;border-radius:12px 12px 12px 2px;max-width:85%;color:#115e59;border:1px solid #ccfbf1;box-shadow:0 1px 2px rgba(0,0,0,0.05);font-size:14px;line-height:1.4">${cleanResponse}</div>`;
        } catch (error) {
            console.error(error);
            const loadingMsg = document.querySelector('div[id^="loading-"]');
            if(loadingMsg) loadingMsg.remove();
            box.innerHTML += `<div style="align-self:flex-start;background:#fee2e2;padding:10px;border-radius:10px;max-width:85%;color:#991b1b;font-size:12px">‚ö†Ô∏è Tu conexi√≥n parece inestable. Intenta de nuevo.</div>`;
        }
        box.scrollTop = box.scrollHeight;
    }

    // Enviar con Enter
    document.getElementById('z-i').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sMsg();
    });
</script>
</body>
</html>
